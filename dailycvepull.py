print('CVE-PULL BY JUSTM0RPH3U5')

import requests
import json
import sys
from io import BytesIO
from zipfile import ZipFile
from urllib.request import urlopen


class Slack(object):
   def __init__(self, file="https://nvd.nist.gov/feeds/json/cve/1.0/nvdcve-1.0-recent.json.zip"):

       self.url = "https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXX"
       self.cookies = {"b": "6699egsd32bz66i6v71kp30k", "x": "6699egbz66iux8a0ye67226v71k"}
       self.headers = {
           "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36",
           "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
           "Accept-Language": "en-US,en;q=0.5", "Accept-Encoding": "gzip, deflate", "DNT": "1",
           "Connection": "close", "Upgrade-Insecure-Requests": "1",
           "Content-Type": "application/x-www-form-urlencoded"}

       resp = urlopen("https://nvd.nist.gov/feeds/json/cve/1.0/nvdcve-1.0-recent.json.zip")
       zipfile = ZipFile(BytesIO(resp.read()))

       self.data = json.loads(zipfile.open("nvdcve-1.0-recent.json").read())

   def send_message(self):
       for item in self.data['CVE_Items']:
           try:
               one_data = dict()
               one_data['title'] = item['cve']['CVE_data_meta']['ID']
               one_data['title_link'] = item['cve']['references']['reference_data'][0]['url']
               one_data['text'] = item['cve']['description']['description_data'][0]['value']
               one_data['author_name'] = item['publishedDate']
               one_data['footer'] = item['lastModifiedDate']

               slack_data = {"attachments": [one_data]}

               r = requests.post(self.url, headers=self.headers,
                                 cookies=self.cookies, data=json.dumps(slack_data), )
               #print(r.status_code)
               #print(r.reason)

           except (KeyError, IndexError):
               pass


if __name__ == '__main__':
   filepath = "https://nvd.nist.gov/feeds/json/cve/1.0/nvdcve-1.0-recent.json.zip"
   if len(sys.argv) > 1:
       filepath = sys.argv[1]

   slack = Slack(filepath)
   slack.send_message()
